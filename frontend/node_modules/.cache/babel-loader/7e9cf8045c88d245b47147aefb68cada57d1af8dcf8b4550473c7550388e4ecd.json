{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useParams}from'react-router-dom';import{useDispatch,useSelector}from'react-redux';import{FILES_BASE_URL}from'../services/api';// adjust path as needed\nimport{getApplicationsForJob,updateApplicationStatus,fetchJob}from'../store/slices/applicationsSlice';import{FiFileText,FiExternalLink}from'react-icons/fi';import DashboardLayout from'../components/DashboardLayout';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function AdminApplications(){const{jobId}=useParams();const dispatch=useDispatch();const apps=useSelector(s=>s.applications.list);const error=useSelector(s=>s.applications.error);const[job,setJob]=useState(null);// Open PDF in new tab\nconst viewPDF=async filename=>{try{const res=await fetch(\"\".concat(FILES_BASE_URL,\"/files/\").concat(filename));if(!res.ok)throw new Error('File not found');const blob=await res.blob();if(blob.type!=='application/pdf')throw new Error('Invalid file type');const url=window.URL.createObjectURL(blob);window.open(url);}catch(err){console.error('Failed to fetch PDF',err);alert('Could not load PDF. File may be missing.');}};useEffect(()=>{if(jobId){dispatch(getApplicationsForJob(jobId)).unwrap().then(data=>console.log('Applications:',data)).catch(()=>{});dispatch(fetchJob(jobId)).unwrap().then(data=>setJob(data)).catch(err=>console.error('Failed to fetch job:',err));}},[dispatch,jobId]);const setStatus=(id,status)=>{const app=apps.find(a=>a.id===id);if(!app)return;// Do not allow status change if already accepted or rejected\nif(app.status==='accepted'||app.status==='rejected'){alert('Cannot change status after final decision');return;}dispatch(updateApplicationStatus({id,status}));};const statusColor=status=>{switch(status){case'reviewed':return'text-yellow-700 bg-yellow-100';case'accepted':return'text-green-700 bg-green-100';case'rejected':return'text-red-700 bg-red-100';default:return'text-gray-700 bg-gray-100';}};return/*#__PURE__*/_jsx(DashboardLayout,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-12xl mx-auto p-12\",children:[error&&/*#__PURE__*/_jsx(\"div\",{className:\"mb-4 p-3 bg-red-100 text-red-700 rounded\",children:error}),job?/*#__PURE__*/_jsxs(\"h2\",{className:\"text-2xl font-bold mb-4\",children:[\"Applications for: \",job.title,\" (ID: \",job.id,\")\"]}):/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold mb-4\",children:\"Loading job info...\"}),apps.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"No applications yet.\"}):/*#__PURE__*/_jsxs(\"table\",{className:\"w-full border-collapse border\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-100\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"border px-4 py-2 text-left\",children:\"Applicant Email\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-4 py-2 text-left\",children:\"Cover Letter\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-4 py-2 text-left\",children:\"CV Link\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-4 py-2 text-left\",children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-4 py-2 text-left\",children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:apps.map(a=>/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"border px-4 py-2\",children:a.applicantEmail}),/*#__PURE__*/_jsx(\"td\",{className:\"border px-4 py-2\",children:a.coverLetter?/*#__PURE__*/_jsxs(\"button\",{onClick:()=>viewPDF(a.coverLetter),className:\"text-blue-600 hover:underline flex items-center\",children:[/*#__PURE__*/_jsx(FiFileText,{className:\"text-red-500 w-5 h-5 mr-1\"}),\"View PDF\"]}):/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"No file\"})}),/*#__PURE__*/_jsx(\"td\",{className:\"border px-4 py-2\",children:a.cvLink?/*#__PURE__*/_jsxs(\"a\",{href:a.cvLink,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-600 hover:underline flex items-center\",children:[\"View CV \",/*#__PURE__*/_jsx(FiExternalLink,{className:\"ml-1 w-4 h-4\"})]}):/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"No link\"})}),/*#__PURE__*/_jsx(\"td\",{className:\"border px-4 py-2 \".concat(statusColor(a.status),\" font-semibold\"),children:a.status.toUpperCase()}),/*#__PURE__*/_jsxs(\"td\",{className:\"border px-4 py-2 space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"px-3 py-1 bg-yellow-200 text-yellow-800 rounded hover:bg-yellow-300\",onClick:()=>setStatus(a.id,'reviewed'),children:\"Review\"}),/*#__PURE__*/_jsx(\"button\",{className:\"px-3 py-1 bg-green-200 text-green-800 rounded hover:bg-green-300\",onClick:()=>setStatus(a.id,'accepted'),children:\"Accept\"}),/*#__PURE__*/_jsx(\"button\",{className:\"px-3 py-1 bg-red-200 text-red-800 rounded hover:bg-red-300\",onClick:()=>setStatus(a.id,'rejected'),children:\"Reject\"})]})]},a.id))})]})]})});}","map":{"version":3,"names":["React","useEffect","useState","useParams","useDispatch","useSelector","FILES_BASE_URL","getApplicationsForJob","updateApplicationStatus","fetchJob","FiFileText","FiExternalLink","DashboardLayout","jsx","_jsx","jsxs","_jsxs","AdminApplications","jobId","dispatch","apps","s","applications","list","error","job","setJob","viewPDF","filename","res","fetch","concat","ok","Error","blob","type","url","window","URL","createObjectURL","open","err","console","alert","unwrap","then","data","log","catch","setStatus","id","status","app","find","a","statusColor","children","className","title","length","map","applicantEmail","coverLetter","onClick","cvLink","href","target","rel","toUpperCase"],"sources":["D:/fullstacker/job-board/frontend/src/pages/AdminApplications.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { FILES_BASE_URL } from '../services/api'; // adjust path as needed\n\n\nimport {\n  getApplicationsForJob,\n  updateApplicationStatus,\n  fetchJob\n} from '../store/slices/applicationsSlice';\nimport { FiFileText, FiExternalLink } from 'react-icons/fi';\nimport DashboardLayout from '../components/DashboardLayout';\n\nexport default function AdminApplications() {\n  const { jobId } = useParams();\n  const dispatch = useDispatch();\n  const apps = useSelector(s => s.applications.list);\n  const error = useSelector(s => s.applications.error);\n  const [job, setJob] = useState(null);\n\n  // Open PDF in new tab\n  const viewPDF = async (filename) => {\n    try {\n      const res = await fetch(`${FILES_BASE_URL}/files/${filename}`);\n\n      if (!res.ok) throw new Error('File not found');\n\n      const blob = await res.blob();\n      if (blob.type !== 'application/pdf') throw new Error('Invalid file type');\n\n      const url = window.URL.createObjectURL(blob);\n      window.open(url);\n    } catch (err) {\n      console.error('Failed to fetch PDF', err);\n      alert('Could not load PDF. File may be missing.');\n    }\n  };\n\n  useEffect(() => {\n    if (jobId) {\n      dispatch(getApplicationsForJob(jobId))\n        .unwrap()\n        .then(data => console.log('Applications:', data))\n        .catch(() => {});\n\n      dispatch(fetchJob(jobId))\n        .unwrap()\n        .then(data => setJob(data))\n        .catch(err => console.error('Failed to fetch job:', err));\n    }\n  }, [dispatch, jobId]);\n\n  const setStatus = (id, status) => {\n    const app = apps.find(a => a.id === id);\n    if (!app) return;\n\n    // Do not allow status change if already accepted or rejected\n    if (app.status === 'accepted' || app.status === 'rejected') {\n      alert('Cannot change status after final decision');\n      return;\n    }\n    dispatch(updateApplicationStatus({ id, status }));\n  };\n\n  const statusColor = (status) => {\n    switch (status) {\n      case 'reviewed': return 'text-yellow-700 bg-yellow-100';\n      case 'accepted': return 'text-green-700 bg-green-100';\n      case 'rejected': return 'text-red-700 bg-red-100';\n      default: return 'text-gray-700 bg-gray-100';\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"max-w-12xl mx-auto p-12\">\n        {error && (\n          <div className=\"mb-4 p-3 bg-red-100 text-red-700 rounded\">\n            {error}\n          </div>\n        )}\n\n        {job ? (\n          <h2 className=\"text-2xl font-bold mb-4\">\n            Applications for: {job.title} (ID: {job.id})\n          </h2>\n        ) : (\n          <h2 className=\"text-2xl font-bold mb-4\">Loading job info...</h2>\n        )}\n\n        {apps.length === 0 ? (\n          <p className=\"text-gray-500\">No applications yet.</p>\n        ) : (\n          <table className=\"w-full border-collapse border\">\n            <thead className=\"bg-gray-100\">\n              <tr>\n                <th className=\"border px-4 py-2 text-left\">Applicant Email</th>\n                <th className=\"border px-4 py-2 text-left\">Cover Letter</th>\n                <th className=\"border px-4 py-2 text-left\">CV Link</th>\n                <th className=\"border px-4 py-2 text-left\">Status</th>\n                <th className=\"border px-4 py-2 text-left\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              {apps.map(a => (\n                <tr key={a.id} className=\"hover:bg-gray-50\">\n                  <td className=\"border px-4 py-2\">{a.applicantEmail}</td>\n                  <td className=\"border px-4 py-2\">\n                    {a.coverLetter ? (\n                      <button\n                        onClick={() => viewPDF(a.coverLetter)}\n                        className=\"text-blue-600 hover:underline flex items-center\"\n                      >\n                        <FiFileText className=\"text-red-500 w-5 h-5 mr-1\" />\n                        View PDF\n                      </button>\n                    ) : (\n                      <span className=\"text-gray-500\">No file</span>\n                    )}\n                  </td>\n                  <td className=\"border px-4 py-2\">\n                    {a.cvLink ? (\n                      <a\n                        href={a.cvLink}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        className=\"text-blue-600 hover:underline flex items-center\"\n                      >\n                        View CV <FiExternalLink className=\"ml-1 w-4 h-4\"/>\n                      </a>\n                    ) : (\n                      <span className=\"text-gray-500\">No link</span>\n                    )}\n                  </td>\n                  <td className={`border px-4 py-2 ${statusColor(a.status)} font-semibold`}>\n                    {a.status.toUpperCase()}\n                  </td>\n                  <td className=\"border px-4 py-2 space-x-2\">\n                    <button\n                      className=\"px-3 py-1 bg-yellow-200 text-yellow-800 rounded hover:bg-yellow-300\"\n                      onClick={() => setStatus(a.id, 'reviewed')}\n                    >\n                      Review\n                    </button>\n                    <button\n                      className=\"px-3 py-1 bg-green-200 text-green-800 rounded hover:bg-green-300\"\n                      onClick={() => setStatus(a.id, 'accepted')}\n                    >\n                      Accept\n                    </button>\n                    <button\n                      className=\"px-3 py-1 bg-red-200 text-red-800 rounded hover:bg-red-300\"\n                      onClick={() => setStatus(a.id, 'rejected')}\n                    >\n                      Reject\n                    </button>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        )}\n      </div>\n    </DashboardLayout>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}