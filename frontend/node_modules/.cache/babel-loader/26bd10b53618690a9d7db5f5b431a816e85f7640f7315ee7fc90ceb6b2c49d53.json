{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useParams}from'react-router-dom';import{useDispatch,useSelector}from'react-redux';import{fetchJob}from'../store/slices/jobsSlice';import{applyJob}from'../store/slices/applicationsSlice';import{FiFileText}from'react-icons/fi';import DashboardLayout from'../components/DashboardLayout';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function JobDetailsDashboard(){const{id}=useParams();const dispatch=useDispatch();const job=useSelector(s=>s.jobs.current);const auth=useSelector(s=>s.auth);const[coverFile,setCoverFile]=useState(null);const[cvLink,setCvLink]=useState('');const[msg,setMsg]=useState('');const[alreadyApplied,setAlreadyApplied]=useState(false);useEffect(()=>{dispatch(fetchJob(id));if(auth.token){fetch(\"/api/applications/check/\".concat(id),{headers:{Authorization:\"Bearer \".concat(auth.token)}}).then(res=>res.json()).then(data=>setAlreadyApplied(data.applied)).catch(err=>console.error(err));}},[dispatch,id,auth.token]);const validateFile=file=>{if(!file)return false;if(file.type!=='application/pdf'){setMsg('❌ Only PDF files are allowed.');return false;}if(file.size>5*1024*1024){setMsg('❌ File must be less than 5MB.');return false;}return true;};const isValidUrl=url=>{try{new URL(url);return true;}catch(_unused){return false;}};const apply=async()=>{if(!auth.token)return setMsg('⚠️ You must log in to apply.');if(!coverFile||!cvLink)return setMsg('⚠️ Please upload cover letter and enter CV link.');if(!isValidUrl(cvLink))return setMsg('❌ CV link must be a valid URL.');try{const formData=new FormData();formData.append('jobId',Number(id));formData.append('coverLetter',coverFile);formData.append('cvLink',cvLink);await dispatch(applyJob(formData)).unwrap();setMsg('✅ Application submitted successfully!');setCoverFile(null);setCvLink('');document.getElementById('coverInput').value='';setAlreadyApplied(true);}catch(e){console.error(e);setMsg('❌ Error submitting application.');}};const renderFile=file=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 py-1\",children:[/*#__PURE__*/_jsx(FiFileText,{className:\"text-red-500 w-5 h-5\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-700\",children:file.name})]});if(!job)return/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center min-h-screen text-gray-500\",children:\"Loading job...\"});return/*#__PURE__*/_jsxs(DashboardLayout,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white shadow-md rounded-lg p-6 mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-3xl font-bold text-gray-800\",children:job.title}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600 text-sm mt-1\",children:[job.company,\" \\u2022 \",job.location]}),job.salary&&/*#__PURE__*/_jsx(\"p\",{className:\"text-green-600 font-semibold mt-1\",children:job.salary})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white shadow-sm rounded-lg p-6 mb-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-semibold text-gray-700 mb-3\",children:\"Job Description\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 leading-relaxed\",children:job.description})]}),alreadyApplied?/*#__PURE__*/_jsx(\"div\",{className:\"bg-yellow-100 text-yellow-800 p-4 rounded-lg\",children:\"\\u26A0\\uFE0F You have already applied to this job.\"}):/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white shadow-lg rounded-lg p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-semibold text-gray-700 mb-4\",children:\"Apply for this job\"}),/*#__PURE__*/_jsx(\"label\",{className:\"block mb-1 font-medium\",children:\"Cover Letter (PDF)\"}),/*#__PURE__*/_jsx(\"input\",{id:\"coverInput\",type:\"file\",accept:\"application/pdf\",onChange:e=>validateFile(e.target.files[0])&&setCoverFile(e.target.files[0]),className:\"mb-2\"}),coverFile&&renderFile(coverFile),/*#__PURE__*/_jsx(\"hr\",{className:\"my-2 border-gray-300\"}),/*#__PURE__*/_jsx(\"label\",{className:\"block mb-1 font-medium\",children:\"CV Link (URL)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"url\",value:cvLink,onChange:e=>setCvLink(e.target.value),placeholder:\"Enter your CV URL\",className:\"mb-2 w-full border border-gray-300 rounded px-3 py-2\"}),/*#__PURE__*/_jsx(\"hr\",{className:\"my-2 border-gray-300\"}),/*#__PURE__*/_jsx(\"button\",{onClick:apply,className:\"bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-6 py-2 rounded-lg transition w-full md:w-auto\",children:\"Submit Application\"}),msg&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-3 text-sm font-medium \".concat(msg.includes('✅')?'text-green-600':msg.includes('⚠️')?'text-yellow-600':'text-red-600'),children:msg})]})]});}","map":{"version":3,"names":["React","useEffect","useState","useParams","useDispatch","useSelector","fetchJob","applyJob","FiFileText","DashboardLayout","jsx","_jsx","jsxs","_jsxs","JobDetailsDashboard","id","dispatch","job","s","jobs","current","auth","coverFile","setCoverFile","cvLink","setCvLink","msg","setMsg","alreadyApplied","setAlreadyApplied","token","fetch","concat","headers","Authorization","then","res","json","data","applied","catch","err","console","error","validateFile","file","type","size","isValidUrl","url","URL","_unused","apply","formData","FormData","append","Number","unwrap","document","getElementById","value","e","renderFile","className","children","name","title","company","location","salary","description","accept","onChange","target","files","placeholder","onClick","includes"],"sources":["D:/fullstacker/job-board/frontend/src/pages/JobDetails.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { fetchJob } from '../store/slices/jobsSlice';\nimport { applyJob } from '../store/slices/applicationsSlice';\nimport { FiFileText } from 'react-icons/fi';\nimport DashboardLayout from '../components/DashboardLayout';\n\nexport default function JobDetailsDashboard() {\n  const { id } = useParams();\n  const dispatch = useDispatch();\n  const job = useSelector(s => s.jobs.current);\n  const auth = useSelector(s => s.auth);\n\n  const [coverFile, setCoverFile] = useState(null);\n  const [cvLink, setCvLink] = useState('');\n  const [msg, setMsg] = useState('');\n  const [alreadyApplied, setAlreadyApplied] = useState(false);\n\n  useEffect(() => {\n    dispatch(fetchJob(id));\n\n    if (auth.token) {\n      fetch(`/api/applications/check/${id}`, {\n        headers: { Authorization: `Bearer ${auth.token}` }\n      })\n        .then(res => res.json())\n        .then(data => setAlreadyApplied(data.applied))\n        .catch(err => console.error(err));\n    }\n  }, [dispatch, id, auth.token]);\n\n  const validateFile = (file) => {\n    if (!file) return false;\n    if (file.type !== 'application/pdf') { setMsg('❌ Only PDF files are allowed.'); return false; }\n    if (file.size > 5 * 1024 * 1024) { setMsg('❌ File must be less than 5MB.'); return false; }\n    return true;\n  };\n\n  const isValidUrl = (url) => {\n    try { new URL(url); return true; } catch { return false; }\n  };\n\n  const apply = async () => {\n    if (!auth.token) return setMsg('⚠️ You must log in to apply.');\n    if (!coverFile || !cvLink) return setMsg('⚠️ Please upload cover letter and enter CV link.');\n    if (!isValidUrl(cvLink)) return setMsg('❌ CV link must be a valid URL.');\n\n    try {\n      const formData = new FormData();\n      formData.append('jobId', Number(id));\n      formData.append('coverLetter', coverFile);\n      formData.append('cvLink', cvLink);\n\n      await dispatch(applyJob(formData)).unwrap();\n      setMsg('✅ Application submitted successfully!');\n      setCoverFile(null);\n      setCvLink('');\n      document.getElementById('coverInput').value = '';\n      setAlreadyApplied(true);\n    } catch (e) {\n      console.error(e);\n      setMsg('❌ Error submitting application.');\n    }\n  };\n\n  const renderFile = (file) => (\n    <div className=\"flex items-center space-x-2 py-1\">\n      <FiFileText className=\"text-red-500 w-5 h-5\" />\n      <span className=\"text-gray-700\">{file.name}</span>\n    </div>\n  );\n\n  if (!job) return <div className=\"flex justify-center items-center min-h-screen text-gray-500\">Loading job...</div>;\n\n  return (\n    <DashboardLayout>\n      <div className=\"bg-white shadow-md rounded-lg p-6 mb-6\">\n        <h2 className=\"text-3xl font-bold text-gray-800\">{job.title}</h2>\n        <p className=\"text-gray-600 text-sm mt-1\">{job.company} • {job.location}</p>\n        {job.salary && <p className=\"text-green-600 font-semibold mt-1\">{job.salary}</p>}\n      </div>\n\n      <div className=\"bg-white shadow-sm rounded-lg p-6 mb-6\">\n        <h3 className=\"text-xl font-semibold text-gray-700 mb-3\">Job Description</h3>\n        <p className=\"text-gray-600 leading-relaxed\">{job.description}</p>\n      </div>\n\n      {alreadyApplied ? (\n        <div className=\"bg-yellow-100 text-yellow-800 p-4 rounded-lg\">\n          ⚠️ You have already applied to this job.\n        </div>\n      ) : (\n        <div className=\"bg-white shadow-lg rounded-lg p-6\">\n          <h3 className=\"text-xl font-semibold text-gray-700 mb-4\">Apply for this job</h3>\n\n          <label className=\"block mb-1 font-medium\">Cover Letter (PDF)</label>\n          <input\n            id=\"coverInput\"\n            type=\"file\"\n            accept=\"application/pdf\"\n            onChange={e => validateFile(e.target.files[0]) && setCoverFile(e.target.files[0])}\n            className=\"mb-2\"\n          />\n          {coverFile && renderFile(coverFile)}\n\n          <hr className=\"my-2 border-gray-300\" />\n\n          <label className=\"block mb-1 font-medium\">CV Link (URL)</label>\n          <input\n            type=\"url\"\n            value={cvLink}\n            onChange={e => setCvLink(e.target.value)}\n            placeholder=\"Enter your CV URL\"\n            className=\"mb-2 w-full border border-gray-300 rounded px-3 py-2\"\n          />\n\n          <hr className=\"my-2 border-gray-300\" />\n\n          <button\n            onClick={apply}\n            className=\"bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-6 py-2 rounded-lg transition w-full md:w-auto\"\n          >\n            Submit Application\n          </button>\n\n          {msg && (\n            <div className={`mt-3 text-sm font-medium ${\n              msg.includes('✅') ? 'text-green-600' : msg.includes('⚠️') ? 'text-yellow-600' : 'text-red-600'\n            }`}>\n              {msg}\n            </div>\n          )}\n        </div>\n      )}\n    </DashboardLayout>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}